---
import BaseLayout from '../layouts/BaseLayout.astro';
import { COURSE_CONFIG } from '../config/course';
import { FileText, ExternalLink, ChevronRight } from 'lucide-astro';

const allLabs = COURSE_CONFIG.modules
  .flatMap(module => module.labs.map(lab => ({
    ...lab,
    module: module.title,
    moduleId: module.id
  })))
  .sort((a, b) => new Date(a.dueDate).getTime() - new Date(b.dueDate).getTime());
---

<BaseLayout title="Laboratorios">
  <div class="prose dark:prose-invert max-w-none">
    <h1 class="text-2xl font-semibold mb-6">Laboratorios</h1>

    <div class="space-y-8">
      {COURSE_CONFIG.modules.map(module => (
        <section>
          <div class="flex items-baseline gap-2 mb-4">
            <h2 class="text-lg font-medium mt-0 mb-0">{module.title}</h2>
            <span class="text-sm text-gray-500">Semanas {module.weeks}</span>
          </div>
          
          <div class="grid gap-4 md:grid-cols-2">
            {module.labs.map(lab => (
              <article class="bg-white dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded p-4">
                <div class="flex items-baseline justify-between mb-3">
                  <h3 class="text-base font-medium mt-0 mb-0">
                    {lab.title}
                  </h3>
                  <time 
                    datetime={lab.dueDate}
                    class="text-xs text-gray-500"
                  >
                    {new Date(lab.dueDate).toLocaleDateString('es-PE', {
                      month: 'short',
                      day: 'numeric'
                    })}
                  </time>
                </div>

                <ul class="mt-2 mb-3 space-y-1">
                  {lab.files.map(file => (
                    <li class="text-sm text-gray-600 dark:text-gray-300 flex items-center gap-2">
                      <FileText class="w-3.5 h-3.5 text-gray-400" />
                      {file}
                    </li>
                  ))}
                </ul>

                <div class="flex items-center justify-between pt-3 border-t border-gray-200 dark:border-gray-700">
                  <a
                    href={`/labs/${module.id}/${lab.id}`}
                    class="text-sm text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300 no-underline hover:underline flex items-center gap-1"
                  >
                    Ver detalles
                    <ChevronRight class="w-4 h-4" />
                  </a>
                  <a
                    href={`${COURSE_CONFIG.repository.url}/tree/${COURSE_CONFIG.repository.branch}/${lab.path}`}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="text-sm text-gray-600 hover:text-gray-500 dark:text-gray-400 dark:hover:text-gray-300 no-underline hover:underline flex items-center gap-1"
                  >
                    GitHub
                    <ExternalLink class="w-3.5 h-3.5" />
                  </a>
                </div>
              </article>
            ))}
          </div>
        </section>
      ))}
    </div>
  </div>
</BaseLayout>
